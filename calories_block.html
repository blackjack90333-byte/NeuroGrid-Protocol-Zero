<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Calorie Sim</title>
    <style>
        body {
            background-color: #11121a;
            color: #fff;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
            box-sizing: border-box;
        }

        /* --- КНОПКА-ТРИГГЕР --- */
        .trigger-btn {
            width: 100%;
            height: 100%;
            background: #1a1c2e;
            border: 2px dashed #06b6d4; /* Циановый пунктир */
            border-radius: 12px;
            color: #06b6d4;
            font-weight: bold;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }

        .trigger-btn:hover {
            background: #06b6d4;
            color: #000;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.4);
        }

        /* --- МОДАЛЬНОЕ ОКНО --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(5, 5, 5, 0.95);
            backdrop-filter: blur(5px);
            z-index: 9999;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            overflow-y: auto;
            padding: 40px 20px;
            box-sizing: border-box;
        }

        .modal-content {
            max-width: 500px;
            margin: 0 auto;
            background: #11121a;
            border: 1px solid #333;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 0 50px rgba(6, 182, 212, 0.2);
        }

        h2 {
            margin-top: 0;
            color: #06b6d4;
            text-transform: uppercase;
            border-bottom: 2px solid #06b6d4;
            padding-bottom: 15px;
            font-size: 20px;
            margin-bottom: 25px;
        }

        /* СЕТКА ВВОДА */
        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 5px;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        label {
            display: block;
            color: #a1a1aa;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: bold;
            text-transform: uppercase;
        }

        input {
            width: 100%;
            background: #1a1c2e;
            border: 1px solid #4b5563;
            color: #fff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: bold;
            box-sizing: border-box;
            text-align: center;
        }

        input:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.2);
        }

        /* БЛОК РЕЗУЛЬТАТОВ */
        .results-box {
            background: #161825;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #333;
        }

        .res-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-family: 'Courier New', monospace;
        }

        .res-row:last-child { margin-bottom: 0; }

        .res-label { font-size: 14px; color: #aaa; }
        
        .res-value { font-size: 18px; font-weight: bold; }
        
        /* Цвета результатов */
        .good { color: #39ff14; } /* Похудение */
        .bad { color: #ef4444; }  /* Набор */
        .neutral { color: #fff; }

        .main-res {
            font-size: 24px;
            text-shadow: 0 0 10px rgba(57, 255, 20, 0.3);
        }

        .btn-close {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-size: 14px;
            background: #333;
            color: #aaa;
            margin-top: 20px;
            transition: 0.2s;
        }
        .btn-close:hover { background: #444; color: #fff; }

    </style>
</head>
<body>

    <div class="trigger-btn" onclick="openModal()">
        ⚡ КАЛЬКУЛЯТОР<br>ККАЛОРИЙ
    </div>

    <div class="modal-overlay" id="modal">
        <div class="modal-content">
            <h2>Симуляция Метаболизма</h2>

            <div class="input-grid">
                <div class="form-group">
                    <label>Твой Вес (КГ)</label>
                    <input type="number" id="in-weight" placeholder="0" oninput="calc()">
                </div>

                <div class="form-group">
                    <label>База (Вес * 24)</label>
                    <input type="text" id="out-bmr" value="0" disabled style="background: #111; color: #555;">
                </div>

                <div class="form-group full-width">
                    <label>Расход Активности (Ккал)</label>
                    <input type="number" id="in-activity" placeholder="Напр: 500 (зал + шаги)" oninput="calc()">
                </div>

                <div class="form-group full-width">
                    <label style="color: #d946ef;">Сколько я ем (Ккал)?</label>
                    <input type="number" id="in-food" placeholder="Напр: 2000" style="border-color: #d946ef;" oninput="calc()">
                </div>
            </div>

            <div class="results-box">
                <div class="res-row">
                    <span class="res-label">Твоя Норма (TDEE):</span>
                    <span class="res-value neutral" id="res-tdee">0 ккал</span>
                </div>
                
                <div class="res-row">
                    <span class="res-label">Баланс в день:</span>
                    <span class="res-value" id="res-balance">0</span>
                </div>

                <div style="height: 1px; background: #333; margin: 15px 0;"></div>

                <div class="res-row">
                    <span class="res-label">Результат за НЕДЕЛЮ:</span>
                    <span class="res-value main-res" id="res-week">0.0 кг</span>
                </div>
                
                <div class="res-row">
                    <span class="res-label">Результат за МЕСЯЦ:</span>
                    <span class="res-value" id="res-month">0.0 кг</span>
                </div>
            </div>

            <button class="btn-close" onclick="closeModal()">Закрыть</button>
        </div>
    </div>

    <script>
        const modal = document.getElementById('modal');

        function openModal() {
            modal.style.display = 'block';
            setTimeout(() => modal.style.opacity = '1', 10);
            if(window.parent && window.parent.document) window.parent.document.body.style.overflow = 'hidden';
            
            // Пытаемся подтянуть вес из настроек, если есть
            loadWeightFromSettings();
            calc();
        }

        function closeModal() {
            modal.style.opacity = '0';
            setTimeout(() => modal.style.display = 'none', 300);
            if(window.parent && window.parent.document) window.parent.document.body.style.overflow = '';
        }

        function loadWeightFromSettings() {
            const rawData = localStorage.getItem('hud_settings');
            if (rawData) {
                try {
                    const settings = JSON.parse(rawData);
                    // Если в JSON есть weight, ставим его. Если нет - оставляем поле пустым
                    if (settings.weight && !document.getElementById('in-weight').value) {
                        document.getElementById('in-weight').value = settings.weight;
                    }
                } catch(e) {}
            }
        }

        function calc() {
            // 1. Получаем данные
            const weight = parseFloat(document.getElementById('in-weight').value) || 0;
            const activity = parseFloat(document.getElementById('in-activity').value) || 0;
            const food = parseFloat(document.getElementById('in-food').value) || 0;

            // 2. Считаем Базу (Вес * 24)
            const bmr = weight * 24;
            document.getElementById('out-bmr').value = bmr.toFixed(0);

            // 3. Считаем Норму (TDEE) = База + Активность
            const tdee = bmr + activity;
            document.getElementById('res-tdee').innerText = tdee.toFixed(0) + " ккал";

            // 4. Считаем Дефицит (Еда - Норма)
            // Если Еда меньше Нормы = число отрицательное (Дефицит)
            // Если Еда больше Нормы = число положительное (Профицит)
            const balance = food - tdee; 

            const balanceEl = document.getElementById('res-balance');
            
            if (balance < 0) {
                balanceEl.innerText = balance.toFixed(0) + " (Дефицит)";
                balanceEl.className = "res-value good";
            } else {
                balanceEl.innerText = "+" + balance.toFixed(0) + " (Профицит)";
                balanceEl.className = "res-value bad";
            }

            // 5. Считаем жир
            // 1 кг жира ~= 7700 ккал
            const kgPerDay = balance / 7700;
            const kgWeek = kgPerDay * 7;
            const kgMonth = kgPerDay * 30;

            // 6. Выводим
            const weekEl = document.getElementById('res-week');
            const monthEl = document.getElementById('res-month');

            // Форматируем с плюсом или минусом
            weekEl.innerText = (kgWeek > 0 ? "+" : "") + kgWeek.toFixed(2) + " кг";
            monthEl.innerText = (kgMonth > 0 ? "+" : "") + kgMonth.toFixed(1) + " кг";

            // Красим
            weekEl.className = kgWeek <= 0 ? "res-value main-res good" : "res-value main-res bad";
            monthEl.className = kgMonth <= 0 ? "res-value good" : "res-value bad";
        }

    </script>
</body>
</html>