<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Active Quest</title>
    <style>
        body {
            background-color: #11121a;
            color: #fff;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- –û–ë–©–ò–ï –°–¢–ò–õ–ò –î–õ–Ø –û–ö–û–ù (VIEWS) --- */
        .view {
            width: 100%;
            height: 100%;
            display: none; /* –°–∫—Ä—ã—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            animation: fadeIn 0.3s ease;
        }

        .view.active {
            display: flex;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- –≠–ö–†–ê–ù 1: –ö–ù–û–ü–ö–ê –°–¢–ê–†–¢–ê --- */
        .start-btn {
            width: 100%;
            height: 100%;
            background: #1a1c2e;
            border: 2px solid #d946ef;
            border-radius: 16px;
            color: #d946ef;
            font-size: 24px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(217, 70, 239, 0.1);
        }

        .start-btn:hover {
            background: #d946ef;
            color: #000;
            box-shadow: 0 0 40px rgba(217, 70, 239, 0.6);
            transform: scale(1.02);
        }

        /* --- –≠–ö–†–ê–ù 2: –í–í–û–î –î–ê–ù–ù–´–• --- */
        
        /* –ù–û–í–´–ô –ë–õ–û–ö –°–°–´–õ–û–ö */
        .helper-links {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .helper-btn {
            flex: 1;
            background: #1a1c2e;
            border: 1px solid #333;
            color: #a1a1aa;
            padding: 8px;
            border-radius: 8px;
            font-size: 11px;
            text-transform: uppercase;
            text-decoration: none;
            text-align: center;
            font-weight: bold;
            transition: 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .helper-btn:hover {
            border-color: #d946ef;
            color: #fff;
            background: rgba(217, 70, 239, 0.1);
        }

        .input-title {
            color: #a1a1aa;
            font-size: 12px;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        textarea {
            flex-grow: 1;
            background: #0f1016;
            border: 1px solid #333;
            color: #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            resize: none;
            outline: none;
            margin-bottom: 15px;
        }

        textarea:focus { border-color: #d946ef; }

        .btn-parse {
            background: #d946ef;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        /* --- –≠–ö–†–ê–ù 3: –°–ü–ò–°–û–ö –ö–í–ï–°–¢–ê --- */
        .quest-header {
            font-size: 18px;
            font-weight: bold;
            color: #d946ef;
            text-transform: uppercase;
            text-align: center;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
            margin-bottom: 15px;
            letter-spacing: 1px;
            text-shadow: 0 0 10px rgba(217, 70, 239, 0.3);
        }

        .quest-list {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 5px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quest-list::-webkit-scrollbar { width: 4px; }
        .quest-list::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        /* –°–¢–ò–õ–ò –ü–£–ù–ö–¢–û–í */
        .step-row {
            display: flex;
            align-items: center;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
        }

        /* 1. –ü–†–û–®–ï–î–®–ò–ï (DONE) */
        .step-row.done {
            background: rgba(57, 255, 20, 0.05);
            color: #666;
            text-decoration: line-through;
            border-left-color: #333;
            transform: scale(0.95);
        }

        /* 2. –¢–ï–ö–£–©–ò–ô (ACTIVE) - –Ø—Ä–∫–∏–π –∏ –±–æ–ª—å—à–æ–π */
        .step-row.active {
            background: linear-gradient(90deg, rgba(217, 70, 239, 0.1), transparent);
            border-left-color: #d946ef;
            color: #fff;
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(217, 70, 239, 0.15);
            font-weight: bold;
            font-size: 16px;
            margin: 10px 0; /* –û—Ç—Å—Ç—É–ø —á—Ç–æ–±—ã –≤—ã–¥–µ–ª–∏—Ç—å */
        }

        /* 3. –ë–£–î–£–©–ò–ï (PENDING) */
        .step-row.pending {
            color: #444;
            background: transparent;
        }

        .step-text {
            flex-grow: 1;
            margin-left: 10px;
        }

        /* –ì–ê–õ–û–ß–ö–ê (–ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è) */
        .check-btn {
            width: 24px;
            height: 24px;
            border: 2px solid #d946ef;
            border-radius: 6px;
            background: transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .check-btn:hover {
            background: #d946ef;
            box-shadow: 0 0 10px #d946ef;
        }

        .check-btn::after {
            content: "‚úî";
            color: #000;
            font-size: 14px;
            display: none;
        }

        /* –ò–∫–æ–Ω–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ (–¥–ª—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π) */
        .done-icon {
            color: #39ff14;
            font-weight: bold;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }

        /* --- –§–ò–ù–ê–õ: –ö–ù–û–ü–ö–ê SHARE --- */
        .share-container {
            margin-top: auto;
            padding-top: 10px;
            display: none; /* –°–∫—Ä—ã—Ç–æ –ø–æ–∫–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª */
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp { from {transform: translateY(20px); opacity: 0;} to {transform: translateY(0); opacity: 1;} }

        .btn-share {
            width: 100%;
            padding: 15px;
            background: #24A1DE;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }
        .btn-share:hover { background: #1b8bbf; }

    </style>
</head>
<body>

    <div class="view active" id="view-start">
        <button class="start-btn" onclick="goToInput()">
            ‚öî –ù–ê–ß–ê–¢–¨ –ö–í–ï–°–¢
        </button>
    </div>

    <div class="view" id="view-input">
        
        <div class="helper-links">
            <a href="https://life-quests-tau.vercel.app/" target="_blank" class="helper-btn">
                üìÇ –û–¢–ö–†–´–¢–¨ –ö–í–ï–°–¢–´
            </a>
            <a href="https://github.com/blackjack90333-byte/life_quests/blob/main/quests.js" target="_blank" class="helper-btn">
                ‚öôÔ∏è –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨
            </a>
        </div>

        <div class="input-title">–í—Å—Ç–∞–≤—å—Ç–µ –∫–≤–µ—Å—Ç (1 —Å—Ç—Ä–æ–∫–∞ - –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ—Å—Ç–∞–ª—å–Ω—ã–µ - —à–∞–≥–∏):</div>
        <textarea id="quest-source" placeholder="–£–ë–ò–ô–¶–ê –î–†–ê–ö–û–ù–û–í
100 –æ—Ç–∂–∏–º–∞–Ω–∏–π
10 –∫–º –±–µ–≥–∞
–ú–µ–¥–∏—Ç–∞—Ü–∏—è"></textarea>
        <button class="btn-parse" onclick="startQuest()">–ü–†–ò–ù–Ø–¢–¨ –í–´–ó–û–í</button>
    </div>

    <div class="view" id="view-quest">
        <div class="quest-header" id="quest-title">TITLE</div>
        
        <div class="quest-list" id="quest-list-container">
            </div>

        <div class="share-container" id="share-block">
            <button class="btn-share" id="share-btn" onclick="shareToTelegram()">
                –û–¢–ü–†–ê–í–ò–¢–¨ –û–¢–ß–ï–¢ –í TELEGRAM ‚úà
            </button>
        </div>
    </div>

    <script>
        // –î–ê–ù–ù–´–ï
        let questTitle = "";
        let questSteps = []; // –ú–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
        let currentStepIndex = 0;

        // –≠–õ–ï–ú–ï–ù–¢–´
        const viewStart = document.getElementById('view-start');
        const viewInput = document.getElementById('view-input');
        const viewQuest = document.getElementById('view-quest');
        
        const sourceText = document.getElementById('quest-source');
        const listContainer = document.getElementById('quest-list-container');
        const titleEl = document.getElementById('quest-title');
        const shareBlock = document.getElementById('share-block');

        // --- –ù–ê–í–ò–ì–ê–¶–ò–Ø ---
        function goToInput() {
            viewStart.classList.remove('active');
            viewInput.classList.add('active');
        }

        // --- –õ–û–ì–ò–ö–ê ---
        function startQuest() {
            const raw = sourceText.value.trim();
            if (!raw) return;

            const lines = raw.split('\n').filter(line => line.trim() !== '');
            if (lines.length < 2) {
                alert("–ù—É–∂–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —à–∞–≥!");
                return;
            }

            // –ü–∞—Ä—Å–∏–Ω–≥
            questTitle = lines[0];
            questSteps = lines.slice(1);
            currentStepIndex = 0;

            // –ü–µ—Ä–µ—Ö–æ–¥
            viewInput.classList.remove('active');
            viewQuest.classList.add('active');
            
            titleEl.innerText = questTitle;
            renderList();
        }

        // --- –†–ï–ù–î–ï–† –°–ü–ò–°–ö–ê ---
        function renderList() {
            listContainer.innerHTML = '';

            questSteps.forEach((step, index) => {
                const row = document.createElement('div');
                let className = 'step-row';
                let iconHtml = '';

                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞
                if (index < currentStepIndex) {
                    // –í–´–ü–û–õ–ù–ï–ù–û
                    className += ' done';
                    iconHtml = '<span class="done-icon">‚úì</span>';
                } else if (index === currentStepIndex) {
                    // –ê–ö–¢–ò–í–ù–û (–¢–ï–ö–£–©–ï–ï)
                    className += ' active';
                    // –ö–Ω–æ–ø–∫–∞-–≥–∞–ª–æ—á–∫–∞
                    iconHtml = `<div class="check-btn" onclick="completeStep()"></div>`;
                } else {
                    // –ë–£–î–£–©–ï–ï
                    className += ' pending';
                    iconHtml = '<span style="width:24px;"></span>'; // –ü—É—Å—Ç–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏—è
                }

                row.className = className;
                row.innerHTML = `
                    ${iconHtml}
                    <span class="step-text">${step}</span>
                `;

                // –ê–≤—Ç–æ-—Å–∫—Ä–æ–ª–ª –∫ –∞–∫—Ç–∏–≤–Ω–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É
                if (index === currentStepIndex) {
                    setTimeout(() => row.scrollIntoView({ behavior: 'smooth', block: 'center' }), 100);
                }

                listContainer.appendChild(row);
            });

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ñ–∏–Ω–∏—à
            if (currentStepIndex >= questSteps.length) {
                shareBlock.style.display = 'block';
                // –í–∏–∑—É–∞–ª—å–Ω—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫ (–º–µ–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –Ω–∞ –∑–µ–ª–µ–Ω—ã–π)
                titleEl.style.color = '#39ff14';
                titleEl.style.textShadow = '0 0 20px #39ff14';
                titleEl.innerText = "QUEST COMPLETED!";
            }
        }

        function completeStep() {
            currentStepIndex++;
            renderList();
        }

        // --- TELEGRAM SHARE (–í–ï–†–°–ò–Ø 5.0: PRIVATE CHANNEL) ---
        function shareToTelegram() {
            // ==========================================
            // –ù–ê–°–¢–†–û–ô–ö–ê: –¢–í–û–ô –ö–û–î –ü–†–ò–ì–õ–ê–®–ï–ù–ò–Ø
            // –°—Å—ã–ª–∫–∞: https://t.me/+TN-Dy093RWw5MDAy
            const INVITE_HASH = 'TN-Dy093RWw5MDAy'; 
            // ==========================================

            // 1. –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç
            let report = `‚öî *QUEST COMPLETED: ${questTitle}*\n\n`;
            questSteps.forEach((step, i) => {
                report += `‚úÖ ${i+1}. ${step}\n`;
            });
            report += `\nüèÜ *STATUS: SUCCESS*`;

            // 2. –ö–æ–ø–∏—Ä—É–µ–º –≤ –±—É—Ñ–µ—Ä (–ì–õ–ê–í–ù–û–ï –î–ï–ô–°–¢–í–ò–ï)
            navigator.clipboard.writeText(report).then(() => {
                const btn = document.getElementById('share-btn');
                const originalText = btn.innerText;
                
                btn.innerText = "–°–ö–û–ü–ò–†–û–í–ê–ù–û! –û–¢–ö–†–´–í–ê–Æ –ß–ê–¢... üöÄ";
                btn.style.background = "#10b981"; 

                // 3. –û—Ç–∫—Ä—ã–≤–∞–µ–º –ß–ê–°–¢–ù–´–ô –∫–∞–Ω–∞–ª —á–µ—Ä–µ–∑ Deep Link
                setTimeout(() => {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º tg://join?invite=...
                    window.location.href = `tg://join?invite=${INVITE_HASH}`;
                    
                    setTimeout(() => {
                        btn.innerText = originalText;
                        btn.style.background = "#24A1DE";
                    }, 2000);
                }, 500);

            }).catch(err => {
                alert("–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è! –†–∞–∑—Ä–µ—à–∏ –¥–æ—Å—Ç—É–ø –∫ –±—É—Ñ–µ—Ä—É.");
            });
        }

    </script>
</body>
</html>